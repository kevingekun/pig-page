import{a as j,r,m as G,j as N,E as C,al as d,at as Q,S as R,o as c,b as D,e as b,X as m,R as T,F as I,ad as z,Q as W,W as A,ab as X,V as K,n as L}from"./vue.Bq5FSDyb.js";import{i as q}from"./echarts.iWV9t_ci.js";import{s as k,E as i,_ as H}from"./index.-C1ni1oB.js";const J={"element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D..."},ee={class:"date-picker-container"},ae={style:{float:"left"}},te={style:{float:"right",color:"#8492a6","font-size":"13px"}},le={class:"chart-container",id:"chart-container"},se=["id"],ne=H(j({__name:"index",setup(re){const P=r({keyword:null,pageNum:1,pageSize:5,publishStatus:null,verifyStatus:null,productSn:null,productCategoryId:null,brandId:null}),v=r([]),o=r([]),S=r([new Date(new Date().setFullYear(new Date().getFullYear()-1)),new Date]),p=r(""),s=r(""),l=r(!1),F=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-6048e5),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-2592e6),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-7776e6),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-15552e6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-31536e6),[e,a]}},{text:"\u6700\u8FD1\u4E24\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-63072e6),[e,a]}},{text:"\u6700\u8FD1\u4E09\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-94608e6),[e,a]}},{text:"\u6700\u8FD1\u4E94\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-15768e7),[e,a]}},{text:"\u5168\u90E8",value:()=>[new Date("2015-01-01"),new Date]}],_=G(()=>p.value?v.value.filter(a=>a.code===p.value):v.value),V=async()=>{const a=await(e=P.value,k({url:"/amin/stocksBase/listAll",method:"get",params:e}));var e;v.value=a.data},$=async a=>{const e=`chart-${a.code}`,w=document.getElementById(e);if(!w)return;const y=q(w);o.value.push(y);const[g,h]=S.value??[null,null],f={code:a.code,startDate:g?g.toISOString().split("T")[0]:null,endDate:h?h.toISOString().split("T")[0]:null};try{const x=await function(n){return k({url:"/amin/historyKl/list",method:"get",params:n})}(f),t=x.data.historyKlList,M=t.map(n=>n.dataTime),Y=t.map(n=>[n.openPrice,n.closePrice,n.lowPrice,n.highPrice]),Z={title:{text:`${a.name} (${a.code})`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:M,boundaryGap:!0,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax"},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",top:"90%",start:0,end:100}],series:[{name:"\u4EF7\u683C",type:"candlestick",data:Y,itemStyle:{color:"#00da3c",color0:"#ec0000",borderColor:"#008F28",borderColor0:"#8A0000"},large:!0}]};y.setOption(Z)}catch{}},u=async()=>{o.value.forEach(e=>{e&&e.dispose()}),o.value=[],await L();for(const e of _.value)await $(e);const a=()=>{o.value.forEach(e=>{e&&e.resize()})};window.addEventListener("resize",a),C(()=>{window.removeEventListener("resize",a)})},E=async()=>{if(s.value){l.value=!0;try{const e=await(a={code:s.value},k({url:"/amin/historyKl/subscribe",method:"get",params:a}));e.code===200?(i.success("\u8BA2\u9605\u6210\u529F"),setTimeout(async()=>{l.value=!1,await V(),await u()},8e3)):(i.error(e.message||"\u8BA2\u9605\u5931\u8D25"),l.value=!1)}catch{l.value=!1}var a}else i.error("\u8BF7\u8F93\u5165\u80A1\u7968\u4EE3\u7801")},O=async()=>{if(s.value){l.value=!0;try{const e=await(a={code:s.value},k({url:"/amin/historyKl/unsubscribe",method:"get",params:a}));e.code===200?(i.success("\u53D6\u6D88\u8BA2\u9605\u6210\u529F"),await V(),await u()):i.error(e.message||"\u53D6\u6D88\u8BA2\u9605\u5931\u8D25"),l.value=!1}catch{l.value=!1}var a}else i.error("\u8BF7\u8F93\u5165\u80A1\u7968\u4EE3\u7801")},U=()=>{u()},B=()=>{L(()=>{u()})};return N(async()=>{await V(),await u()}),C(()=>{o.value.forEach(a=>{a&&a.dispose()}),o.value=[]}),(a,e)=>{const w=d("el-date-picker"),y=d("el-option"),g=d("el-select"),h=d("el-input"),f=d("el-button"),x=Q("loading");return R((c(),D("div",J,[b("div",ee,[m(w,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=t=>S.value=t),type:"daterange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",shortcuts:F,onChange:U},null,8,["modelValue"]),m(g,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),placeholder:"\u8BF7\u9009\u62E9\u80A1\u7968",clearable:"",filterable:"",onChange:B,style:{"margin-left":"10px",width:"200px"}},{default:T(()=>[(c(!0),D(I,null,z(v.value,t=>(c(),W(y,{key:t.code,label:t.name,value:t.code},{default:T(()=>[b("span",ae,A(t.name),1),b("span",te,A(t.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),m(h,{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value=t),placeholder:"\u8F93\u5165\u80A1\u7968\u4EE3\u7801",style:{"margin-left":"10px",width:"150px"},disabled:l.value,onKeyup:X(E,["enter"])},null,8,["modelValue","disabled"]),m(f,{type:"primary",style:{"margin-left":"10px"},disabled:l.value||!s.value,onClick:E},{default:T(()=>e[3]||(e[3]=[K(" \u8BA2\u9605 ")])),_:1},8,["disabled"]),m(f,{type:"primary",style:{"margin-left":"10px"},disabled:l.value||!s.value,onClick:O},{default:T(()=>e[4]||(e[4]=[K(" \u53D6\u6D88\u8BA2\u9605 ")])),_:1},8,["disabled"])]),b("div",le,[(c(!0),D(I,null,z(_.value,t=>(c(),D("div",{key:t.code,class:"chart",id:`chart-${t.code}`},null,8,se))),128))])])),[[x,l.value,void 0,{body:!0,lock:!0}]])}}}),[["__scopeId","data-v-a6f35302"]]);export{ne as default};
