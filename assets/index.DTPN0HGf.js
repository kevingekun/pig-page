import{a as Y,r as n,m as Z,j as B,E as $,al as p,at as Q,S as R,o,b as w,e as D,X as y,R as b,F as S,ad as _,Q as U,W as A,ab as W,V as X,n as F}from"./vue.Bq5FSDyb.js";import{i as q}from"./echarts.iWV9t_ci.js";import{g as H,a as J,f as ee}from"./ibkr.DyyeWeVv.js";import{E as i,_ as ae}from"./index.XaB_BWRs.js";const te={"element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D..."},le={class:"date-picker-container"},ne={style:{float:"left"}},oe={style:{float:"right",color:"#8492a6","font-size":"13px"}},re={class:"chart-container",id:"chart-container"},se=["id"],ue=ae(Y({__name:"index",setup(ie){const E=n({keyword:null,pageNum:1,pageSize:5,publishStatus:null,verifyStatus:null,productSn:null,stockGroupId:null,brandId:null}),g=n([]),I=n([]),r=n([]),T=n([new Date(new Date().setFullYear(new Date().getFullYear()-1)),new Date]),s=n(""),l=n(""),V=n(""),d=n(!1),G=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-6048e5),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-2592e6),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-7776e6),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-15552e6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-31536e6),[e,a]}},{text:"\u6700\u8FD1\u4E24\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-63072e6),[e,a]}},{text:"\u6700\u8FD1\u4E09\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-94608e6),[e,a]}},{text:"\u6700\u8FD1\u4E94\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-15768e7),[e,a]}},{text:"\u5168\u90E8",value:()=>[new Date("2015-01-01"),new Date]}],C=Z(()=>s.value?g.value.filter(a=>a.code===s.value):l.value?[{code:l.value,name:l.value}]:g.value),z=async()=>{try{E.value.stockGroupId=V.value||"0";const a=await J(E.value);g.value=a.data}catch{i.error("\u83B7\u53D6\u80A1\u7968\u5217\u8868\u5931\u8D25")}},L=async a=>{const e=`chart-${a.code}`,x=document.getElementById(e);if(!x)return;const c=q(x);r.value.push(c);const[v,f]=T.value??[null,null],k={code:a.code,startDate:v?v.toISOString().split("T")[0]:null,endDate:f?f.toISOString().split("T")[0]:null};try{const m=(await ee(k)).data.historyKlList,t=m.map(u=>u.dataTime),M=m.map(u=>[u.openPrice,u.closePrice,u.lowPrice,u.highPrice]),N={title:{text:`${a.name} (${a.code})`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:t,boundaryGap:!0,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax"},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",top:"90%",start:0,end:100}],series:[{name:"\u4EF7\u683C",type:"candlestick",data:M,itemStyle:{color:"#ab00da",color0:"#000000",borderColor:"#ab00da",borderColor0:"#000000"},large:!0}]};c.setOption(N)}catch{i.error(`\u65E0\u6CD5\u83B7\u53D6\u80A1\u7968 ${a.code} \u7684\u6570\u636E`)}},h=async()=>{r.value.forEach(e=>{e&&e.dispose()}),r.value=[],await F();for(const e of C.value)await L(e);const a=()=>{r.value.forEach(e=>{e&&e.resize()})};window.addEventListener("resize",a),$(()=>{window.removeEventListener("resize",a)})},O=()=>{h()},j=()=>{l.value="",F(()=>{h()})},K=async()=>{s.value="",l.value="",await z(),await h()},P=async()=>{if(l.value){d.value=!0;try{s.value="";const a={code:l.value,name:l.value};await L(a),i.success("\u67E5\u8BE2\u80A1\u7968\u6210\u529F")}catch{i.error("\u67E5\u8BE2\u80A1\u7968\u5931\u8D25")}finally{d.value=!1}}else i.error("\u8BF7\u8F93\u5165\u80A1\u7968\u4EE3\u7801")};return B(async()=>{await(async()=>{try{const a=await H("0");I.value=a.data}catch{i.error("\u83B7\u53D6\u80A1\u7968\u5206\u7C7B\u5931\u8D25")}})(),await z(),await h()}),$(()=>{r.value.forEach(a=>{a&&a.dispose()}),r.value=[]}),(a,e)=>{const x=p("el-date-picker"),c=p("el-option"),v=p("el-select"),f=p("el-input"),k=p("el-button"),m=Q("loading");return R((o(),w("div",te,[D("div",le,[y(x,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t),type:"daterange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",shortcuts:G,onChange:O,style:{"margin-right":"10px"}},null,8,["modelValue"]),y(v,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),placeholder:"\u80A1\u7968\u5206\u7C7B",clearable:"",onChange:K,style:{"margin-right":"10px",width:"100px"}},{default:b(()=>[(o(!0),w(S,null,_(I.value,t=>(o(),U(c,{key:t.id,label:t.groupName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),y(v,{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value=t),placeholder:"\u8BF7\u9009\u62E9\u80A1\u7968",clearable:"",filterable:"",onChange:j,style:{"margin-left":"10px",width:"200px"}},{default:b(()=>[(o(!0),w(S,null,_(g.value,t=>(o(),U(c,{key:t.code,label:t.name,value:t.code},{default:b(()=>[D("span",ne,A(t.name),1),D("span",oe,A(t.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),y(f,{modelValue:l.value,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value=t),placeholder:"\u80A1\u7968\u4EE3\u7801",style:{"margin-left":"10px",width:"100px"},disabled:d.value,onKeyup:W(P,["enter"])},null,8,["modelValue","disabled"]),y(k,{type:"primary",style:{"margin-left":"10px"},disabled:d.value,onClick:P},{default:b(()=>e[4]||(e[4]=[X(" \u67E5\u8BE2 ")])),_:1},8,["disabled"])]),D("div",re,[(o(!0),w(S,null,_(C.value,t=>(o(),w("div",{key:t.code,class:"chart",id:`chart-${t.code}`},null,8,se))),128))])])),[[m,d.value]])}}}),[["__scopeId","data-v-bac6ece3"]]);export{ue as default};
