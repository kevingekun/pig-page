import{a as K,b as M,g as Y,v as Z,d as ee}from"./user.DJa7IJOs.js";import{l as ae}from"./role.DaFHXvXY.js";import{l as le}from"./post.DJ7NW2ZY.js";import{d as re}from"./dept.DsRxfKsP.js";import{u as se}from"./dict.CvMx61Qh.js";import{v as oe,d as f,r as i}from"./index.G4Dhx3nr.js";import{a as T,r as b,a0 as te,al as u,at as de,b as v,o as p,X as r,R as t,S as ue,Q as h,u as o,F as _,ad as y,V as I,W as k,e as me,H as ne,n as ie}from"./vue.Bq5FSDyb.js";import"./dict.CMxjV9P8.js";const pe={class:"system-user-dialog-container"},ce={class:"dialog-footer"},ge=T({name:"systemUserDialog"}),be=T({...ge,emits:["refresh"],setup(fe,{expose:O,emit:S}){const{t:w}=oe.useI18n(),$=S,{lock_flag:C}=se("lock_flag"),V=b(),c=b(!1),L=b([]),U=b([]),q=b([]),g=b(!1),a=te({userId:"",username:"",password:"",salt:"",wxOpenid:"",qqOpenid:"",lockFlag:"0",phone:"",deptId:"",roleList:[],postList:[],nickname:"",name:"",email:"",post:[],role:[]}),D=b({username:[{validator:i.overLength,trigger:"blur"},{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:5,max:20,message:"\u7528\u6237\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"},{validator:(l,e,d)=>{ee(l,e,d,a.userId!=="")},trigger:"blur"}],password:[{validator:i.overLength,trigger:"blur"},{required:!0,message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:6,max:20,message:"\u7528\u6237\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],name:[{required:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:i.overLength,trigger:"blur"},{validator:i.chinese,trigger:"blur"}],deptId:[{required:!0,message:"\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],role:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],post:[{required:!0,message:"\u5C97\u4F4D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],phone:[{required:!0,message:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:i.overLength,trigger:"blur"},{validator:i.validatePhone,trigger:"blur"},{validator:(l,e,d)=>{Z(l,e,d,a.userId!=="")},trigger:"blur"}],email:[{validator:i.overLength,trigger:"blur"},{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:["blur","change"]}],lockFlag:[{required:!0,message:"\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nickname:[{validator:i.overLength,trigger:"blur"}]}),N=async()=>{if(!await V.value.validate().catch(()=>{}))return!1;try{const{userId:l,phone:e,password:d}=a;l?(e!=null&&e.includes("*")&&(a.phone=void 0),d!=null&&d.includes("******")&&(a.password=void 0),g.value=!0,await K(a),f().success(w("common.editSuccessText")),c.value=!1,$("refresh")):(g.value=!0,await M(a),f().success(w("common.addSuccessText")),c.value=!1,$("refresh"))}catch(l){f().error(l.msg)}finally{g.value=!1}},R=async l=>{try{g.value=!0;const{data:e}=await Y(l);Object.assign(a,e),e.roleList&&(a.role=e.roleList.map(d=>d.roleId)),e.postList&&(a.post=e.postList.map(d=>d.postId))}catch(e){f().error(e.msg)}finally{g.value=!1}},j=()=>{re().then(l=>{L.value=l.data,a.deptId=l.data[0].id})},H=()=>{le().then(l=>{q.value=l.data,a.post=[l.data[0].postId]})},P=()=>{ae().then(l=>{U.value=l.data,a.role=[l.data[0].roleId]})};return O({openDialog:async l=>{c.value=!0,a.userId="",ie(()=>{var e;(e=V.value)==null||e.resetFields()}),j(),H(),P(),l&&(a.userId=l,await R(l),a.password="******")}}),(l,e)=>{const d=u("el-input"),m=u("el-form-item"),n=u("el-col"),x=u("el-option"),F=u("el-select"),Q=u("el-tree-select"),W=u("el-radio"),X=u("el-radio-group"),z=u("el-row"),A=u("el-form"),B=u("el-button"),E=u("el-dialog"),G=de("loading");return p(),v("div",pe,[r(E,{"close-on-click-modal":!1,title:o(a).userId?l.$t("common.editBtn"):l.$t("common.addBtn"),draggable:"",modelValue:o(c),"onUpdate:modelValue":e[11]||(e[11]=s=>ne(c)?c.value=s:null)},{footer:t(()=>[me("span",ce,[r(B,{onClick:e[10]||(e[10]=s=>c.value=!1)},{default:t(()=>[I(k(l.$t("common.cancelButtonText")),1)]),_:1}),r(B,{onClick:N,type:"primary",disabled:o(g)},{default:t(()=>[I(k(l.$t("common.confirmButtonText")),1)]),_:1},8,["disabled"])])]),default:t(()=>[ue((p(),h(A,{model:o(a),rules:o(D),"label-width":"90px",ref_key:"dataFormRef",ref:V},{default:t(()=>[r(z,{gutter:20},{default:t(()=>[r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.username"),prop:"username"},{default:t(()=>[r(d,{disabled:o(a).userId!=="",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",modelValue:o(a).username,"onUpdate:modelValue":e[0]||(e[0]=s=>o(a).username=s)},null,8,["disabled","modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.password"),prop:"password"},{default:t(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password",modelValue:o(a).password,"onUpdate:modelValue":e[1]||(e[1]=s=>o(a).password=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.name"),prop:"name"},{default:t(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",modelValue:o(a).name,"onUpdate:modelValue":e[2]||(e[2]=s=>o(a).name=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.phone"),prop:"phone"},{default:t(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",modelValue:o(a).phone,"onUpdate:modelValue":e[3]||(e[3]=s=>o(a).phone=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.role"),prop:"role"},{default:t(()=>[r(F,{class:"w100",clearable:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272",modelValue:o(a).role,"onUpdate:modelValue":e[4]||(e[4]=s=>o(a).role=s)},{default:t(()=>[(p(!0),v(_,null,y(o(U),s=>(p(),h(x,{key:s.roleId,label:s.roleName,value:s.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.post"),prop:"post"},{default:t(()=>[r(F,{class:"w100",clearable:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5C97\u4F4D",modelValue:o(a).post,"onUpdate:modelValue":e[5]||(e[5]=s=>o(a).post=s)},{default:t(()=>[(p(!0),v(_,null,y(o(q),s=>(p(),h(x,{key:s.postId,label:s.postName,value:s.postId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.dept"),prop:"deptId"},{default:t(()=>[r(Q,{data:o(L),props:{value:"id",label:"name",children:"children"},"check-strictly":"",class:"w100",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u90E8\u95E8",modelValue:o(a).deptId,"onUpdate:modelValue":e[6]||(e[6]=s=>o(a).deptId=s)},null,8,["data","modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.email"),prop:"email"},{default:t(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",modelValue:o(a).email,"onUpdate:modelValue":e[7]||(e[7]=s=>o(a).email=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.nickname"),prop:"nickname"},{default:t(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0",modelValue:o(a).nickname,"onUpdate:modelValue":e[8]||(e[8]=s=>o(a).nickname=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:t(()=>[r(m,{label:l.$t("sysuser.lockFlag"),prop:"lockFlag"},{default:t(()=>[r(X,{modelValue:o(a).lockFlag,"onUpdate:modelValue":e[9]||(e[9]=s=>o(a).lockFlag=s)},{default:t(()=>[(p(!0),v(_,null,y(o(C),(s,J)=>(p(),h(W,{key:J,label:s.value,border:""},{default:t(()=>[I(k(s.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[G,o(g)]])]),_:1},8,["title","modelValue"])])}}});export{be as default};
