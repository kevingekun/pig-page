import{v as R,d as f,r as q}from"./index.Bmo3XfDz.js";import{d as F}from"./dept.CGKkcM6r.js";import{p as j,a as H,g as O,v as P,b as Q}from"./role.B_ict0zc.js";import{a as h,r as c,a0 as _,al as i,at as W,Q as v,o as y,R as t,S as X,u as o,X as s,e as z,V as D,W as V,H as A,n as E}from"./vue.Bq5FSDyb.js";const G={class:"dialog-footer"},J=h({name:"systemRoleDialog"}),K=h({...J,emits:["refresh"],setup(L,{expose:x,emit:C}){const I=C,{t:$}=R.useI18n(),n=c();c();const m=c(!1),u=c(!1),a=_({roleId:"",roleName:"",roleCode:"",roleDesc:"",dsScope:""}),p=_({deptData:[],checkedDsScope:[],deptProps:{children:"children",label:"name",value:"id"}}),S=c({roleName:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:3,max:20,message:"\u957F\u5EA6\u5728 3 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"blur"},{validator:(e,l,d)=>{Q(e,l,d,a.roleId!=="")},trigger:"blur"}],roleCode:[{required:!0,message:"\u89D2\u8272\u6807\u8BC6\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:3,max:20,message:"\u957F\u5EA6\u5728 3 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"blur"},{validator:q.validatorCapital,trigger:"blur"},{validator:(e,l,d)=>{P(e,l,d,a.roleId!=="")},trigger:"blur"}],roleDesc:[{max:128,message:"\u957F\u5EA6\u5728 128 \u4E2A\u5B57\u7B26\u5185",trigger:"blur"}]}),k=async()=>{if(!await n.value.validate().catch(()=>{}))return!1;try{u.value=!0,a.roleId?await j(a):await H(a),f().success($(a.roleId?"common.editSuccessText":"common.addSuccessText")),m.value=!1,I("refresh")}catch(e){f().error(e.msg)}finally{u.value=!1}},w=e=>{O(e).then(l=>{Object.assign(a,l.data),l.data.dsScope?p.checkedDsScope=l.data.dsScope.split(","):p.checkedDsScope=[]})},N=()=>{F().then(e=>{p.deptData=e.data})};return x({openDialog:e=>{m.value=!0,a.roleId="",E(()=>{n.value.resetFields()}),e&&(a.roleId=e,w(e)),N()}}),(e,l)=>{const d=i("el-input"),g=i("el-form-item"),B=i("el-form"),b=i("el-button"),T=i("el-dialog"),U=W("loading");return y(),v(T,{"close-on-click-modal":!1,title:o(a).roleId?e.$t("common.editBtn"):e.$t("common.addBtn"),width:"600",draggable:"",modelValue:o(m),"onUpdate:modelValue":l[4]||(l[4]=r=>A(m)?m.value=r:null)},{footer:t(()=>[z("span",G,[s(b,{onClick:l[3]||(l[3]=r=>m.value=!1)},{default:t(()=>[D(V(e.$t("common.cancelButtonText")),1)]),_:1}),s(b,{onClick:k,type:"primary",disabled:o(u)},{default:t(()=>[D(V(e.$t("common.confirmButtonText")),1)]),_:1},8,["disabled"])])]),default:t(()=>[X((y(),v(B,{model:o(a),rules:o(S),"label-width":"90px",ref_key:"dataFormRef",ref:n},{default:t(()=>[s(g,{label:e.$t("sysrole.roleName"),prop:"roleName"},{default:t(()=>[s(d,{placeholder:e.$t("sysrole.please_enter_a_role_name"),clearable:"",modelValue:o(a).roleName,"onUpdate:modelValue":l[0]||(l[0]=r=>o(a).roleName=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),s(g,{label:e.$t("sysrole.roleCode"),prop:"roleCode"},{default:t(()=>[s(d,{placeholder:e.$t("sysrole.please_enter_the_role_Code"),disabled:o(a).roleId!=="",clearable:"",modelValue:o(a).roleCode,"onUpdate:modelValue":l[1]||(l[1]=r=>o(a).roleCode=r)},null,8,["placeholder","disabled","modelValue"])]),_:1},8,["label"]),s(g,{label:e.$t("sysrole.roleDesc"),prop:"roleDesc"},{default:t(()=>[s(d,{placeholder:e.$t("sysrole.please_enter_the_role_description"),maxlength:"150",rows:"3",type:"textarea",modelValue:o(a).roleDesc,"onUpdate:modelValue":l[2]||(l[2]=r=>o(a).roleDesc=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[U,o(u)]])]),_:1},8,["title","modelValue"])}}});export{K as default};
