import{a as j,r,m as B,j as G,E,al as p,at as N,S as Q,o as v,b as T,e as S,X as d,R as w,F as I,ad as P,Q as R,W as z,ab as W,V as _,n as L}from"./vue.Bq5FSDyb.js";import{i as X}from"./echarts.iWV9t_ci.js";import{f as q,s as H,u as J,m as ee,a as ae}from"./ibkr.CHOz6S_d.js";import{E as s,_ as te}from"./index.Zpg3H9AI.js";const le={"element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D..."},ne={class:"date-picker-container"},se={style:{float:"left"}},re={style:{float:"right",color:"#8492a6","font-size":"13px"}},ie={class:"chart-container",id:"chart-container"},oe=["id"],ue=te(j({__name:"index",setup(de){const A=r({keyword:null,pageNum:1,pageSize:5,publishStatus:null,verifyStatus:null,productSn:null,productCategoryId:null,brandId:null}),y=r([]),i=r([]),V=r([new Date(new Date().setFullYear(new Date().getFullYear()-1)),new Date]),f=r(""),n=r(""),l=r(!1),F=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-6048e5),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-2592e6),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-7776e6),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-15552e6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-31536e6),[e,a]}},{text:"\u6700\u8FD1\u4E24\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-63072e6),[e,a]}},{text:"\u6700\u8FD1\u4E09\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-94608e6),[e,a]}},{text:"\u6700\u8FD1\u4E94\u5E74",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-15768e7),[e,a]}},{text:"\u5168\u90E8",value:()=>[new Date("2015-01-01"),new Date]}],k=B(()=>f.value?y.value.filter(a=>a.code===f.value):y.value),g=async()=>{try{const a=await q(A.value);y.value=a.data}catch{}},$=async a=>{const e=`chart-${a.code}`,h=document.getElementById(e);if(!h)return;const x=X(h);i.value.push(x);const[D,b]=V.value??[null,null],c={code:a.code,startDate:D?D.toISOString().split("T")[0]:null,endDate:b?b.toISOString().split("T")[0]:null};try{const m=(await ae(c)).data.historyKlList,t=m.map(u=>u.dataTime),Y=m.map(u=>[u.openPrice,u.closePrice,u.lowPrice,u.highPrice]),Z={title:{text:`${a.name} (${a.code})`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:t,boundaryGap:!0,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax"},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",top:"90%",start:0,end:100}],series:[{name:"\u4EF7\u683C",type:"candlestick",data:Y,itemStyle:{color:"#00da3c",color0:"#ec0000",borderColor:"#008F28",borderColor0:"#8A0000"},large:!0}]};x.setOption(Z)}catch{}},o=async()=>{i.value.forEach(e=>{e&&e.dispose()}),i.value=[],await L();for(const e of k.value)$(e);const a=()=>{i.value.forEach(e=>{e&&e.resize()})};window.addEventListener("resize",a),E(()=>{window.removeEventListener("resize",a)})},C=async()=>{if(n.value){l.value=!0;try{await H({code:n.value}),s.success("\u8BA2\u9605\u6210\u529F"),await g(),await o()}catch(a){s.error(a.msg||"\u8BA2\u9605\u5931\u8D25")}finally{l.value=!1}}else s.error("\u8BF7\u8F93\u5165\u80A1\u7968\u4EE3\u7801")},O=async()=>{if(n.value){l.value=!0;try{await J({code:n.value}),s.success("\u53D6\u6D88\u8BA2\u9605\u6210\u529F"),await g(),await o()}catch{s.error("\u53D6\u6D88\u8BA2\u9605\u5931\u8D25")}finally{l.value=!1}}else s.error("\u8BF7\u8F93\u5165\u80A1\u7968\u4EE3\u7801")},U=async()=>{l.value=!0;try{await ee(""),s.success("\u624B\u52A8\u66F4\u65B0\u6570\u636E\u6210\u529F"),await g(),await o()}catch{s.error("\u624B\u52A8\u66F4\u65B0\u6570\u636E\u5931\u8D25")}finally{l.value=!1}},K=()=>{o()},M=()=>{L(()=>{o()})};return G(async()=>{await g(),await o()}),E(()=>{i.value.forEach(a=>{a&&a.dispose()}),i.value=[]}),(a,e)=>{const h=p("el-date-picker"),x=p("el-option"),D=p("el-select"),b=p("el-input"),c=p("el-button"),m=N("loading");return Q((v(),T("div",le,[S("div",ne,[d(h,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),type:"daterange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",shortcuts:F,onChange:K},null,8,["modelValue"]),d(D,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),placeholder:"\u8BF7\u9009\u62E9\u80A1\u7968",clearable:"",filterable:"",onChange:M,style:{"margin-left":"10px",width:"200px"}},{default:w(()=>[(v(!0),T(I,null,P(y.value,t=>(v(),R(x,{key:t.code,label:t.name,value:t.code},{default:w(()=>[S("span",se,z(t.name),1),S("span",re,z(t.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),d(b,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value=t),placeholder:"\u8F93\u5165\u80A1\u7968\u4EE3\u7801",style:{"margin-left":"10px",width:"150px"},disabled:l.value,onKeyup:W(C,["enter"])},null,8,["modelValue","disabled"]),d(c,{type:"primary",style:{"margin-left":"10px"},disabled:l.value||!n.value,onClick:C},{default:w(()=>e[3]||(e[3]=[_(" \u8BA2\u9605 ")])),_:1},8,["disabled"]),d(c,{type:"primary",style:{"margin-left":"10px"},disabled:l.value||!n.value,onClick:O},{default:w(()=>e[4]||(e[4]=[_(" \u53D6\u6D88\u8BA2\u9605 ")])),_:1},8,["disabled"]),d(c,{type:"primary",style:{"margin-left":"10px"},disabled:l.value,onClick:U},{default:w(()=>e[5]||(e[5]=[_(" \u624B\u52A8\u66F4\u65B0\u6570\u636E ")])),_:1},8,["disabled"])]),S("div",ie,[(v(!0),T(I,null,P(k.value,t=>(v(),T("div",{key:t.code,class:"chart",id:`chart-${t.code}`},null,8,oe))),128))])])),[[m,l.value]])}}}),[["__scopeId","data-v-57d8ec01"]]);export{ue as default};
